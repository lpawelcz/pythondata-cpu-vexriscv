SRC := ${shell find . -type f -name \*.scala}

all: VexRiscv.v VexRiscv_Debug.v VexRiscv_Lite.v VexRiscv_LiteDebug.v VexRiscv_IMAC.v VexRiscv_IMACDebug.v VexRiscv_Min.v VexRiscv_MinDebug.v VexRiscv_Full.v VexRiscv_FullDebug.v VexRiscv_Linux.v VexRiscv_LinuxDebug.v VexRiscv_LinuxNoDspFmax.v VexRiscv_FullCfu.v VexRiscv_FullCfuDebug.v VexRiscv_SlimCfu.v VexRiscv_SlimCfuDebug.v VexRiscv_LiteCfu.v VexRiscv_LiteCfuDebug.v

VexRiscv.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault"

VexRiscv_Debug.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault -d --outputFile VexRiscv_Debug"

VexRiscv_Lite.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --iCacheSize 2048 --dCacheSize 0 --mulDiv true --singleCycleShift false --singleCycleMulDiv false  --outputFile VexRiscv_Lite"

VexRiscv_LiteDebug.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault -d --iCacheSize 2048 --dCacheSize 0 --mulDiv true --singleCycleShift false --singleCycleMulDiv false --outputFile VexRiscv_LiteDebug"

VexRiscv_IMAC.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --csrPluginConfig all --atomics true --compressedGen true --outputFile VexRiscv_IMAC"

VexRiscv_IMACDebug.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --csrPluginConfig all --atomics true --compressedGen true -d --outputFile VexRiscv_IMACDebug"

VexRiscv_Min.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --iCacheSize 0 --dCacheSize 0 --mulDiv false --singleCycleShift false --singleCycleMulDiv false --bypass false --prediction none --outputFile VexRiscv_Min"

VexRiscv_MinDebug.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault -d --iCacheSize 0 --dCacheSize 0 --mulDiv false --singleCycleShift false --singleCycleMulDiv false --bypass false --prediction none --outputFile VexRiscv_MinDebug"

VexRiscv_Full.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --csrPluginConfig all --outputFile VexRiscv_Full"

VexRiscv_FullDebug.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --csrPluginConfig all -d --outputFile VexRiscv_FullDebug"

# CFU versions must have module name changed because they will be wrapped
VexRiscv_FullCfu.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --dCacheSize 8192 --iCacheSize 8192 --csrPluginConfig all --cfu true --perfCSRs 8 --outputFile VexRiscv_FullCfu"
	sed -e 's/module VexRiscv/module VexRiscv_inner/' $@ > tmp.v
	/bin/mv tmp.v $@
	./genWrapper.py $@ > wrap$@

# CFU versions must have module name changed because they will be wrapped
VexRiscv_FullCfuDebug.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --dCacheSize 8192 --iCacheSize 8192 --csrPluginConfig all -d --cfu true --perfCSRs 8 --outputFile VexRiscv_FullCfuDebug"
	sed -e 's/module VexRiscv/module VexRiscv_inner/' $@ > tmp.v
	/bin/mv tmp.v $@
	./genWrapper.py $@ > wrap$@

# CFU versions must have module name changed because they will be wrapped
VexRiscv_SlimCfu.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --dCacheSize 0 --iCacheSize 1024 --csrPluginConfig all --cfu true --perfCSRs 8 --outputFile VexRiscv_SlimCfu"
	sed -e 's/module VexRiscv/module VexRiscv_inner/' $@ > tmp.v
	/bin/mv tmp.v $@
	./genWrapper.py $@ > wrap$@

# CFU versions must have module name changed because they will be wrapped
VexRiscv_SlimCfuDebug.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --dCacheSize 0 --iCacheSize 1024 --csrPluginConfig all -d --cfu true --perfCSRs 8 --outputFile VexRiscv_SlimCfuDebug"
	sed -e 's/module VexRiscv/module VexRiscv_inner/' $@ > tmp.v
	/bin/mv tmp.v $@
	./genWrapper.py $@ > wrap$@

# CFU versions must have module name changed because they will be wrapped
VexRiscv_LiteCfu.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --iCacheSize 1024 --dCacheSize 0 --mulDiv true --singleCycleShift false --singleCycleMulDiv false --csrPluginConfig all --cfu true --perfCSRs 8 --outputFile VexRiscv_LiteCfu"
	sed -e 's/module VexRiscv/module VexRiscv_inner/' $@ > tmp.v
	/bin/mv tmp.v $@
	./genWrapper.py $@ > wrap$@

# CFU versions must have module name changed because they will be wrapped
VexRiscv_LiteCfuDebug.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --iCacheSize 1024 --dCacheSize 0 --mulDiv true --singleCycleShift false --singleCycleMulDiv false --csrPluginConfig all -d --cfu true --perfCSRs 8 --outputFile VexRiscv_LiteCfuDebug"
	sed -e 's/module VexRiscv/module VexRiscv_inner/' $@ > tmp.v
	/bin/mv tmp.v $@
	./genWrapper.py $@ > wrap$@

VexRiscv_Linux.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --csrPluginConfig linux-minimal --outputFile VexRiscv_Linux"

VexRiscv_LinuxDebug.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --csrPluginConfig linux-minimal -d --outputFile VexRiscv_LinuxDebug"

VexRiscv_LinuxNoDspFmax.v: $(SRC)
	sbt compile "runMain vexriscv.GenCoreDefault --csrPluginConfig linux-minimal --singleCycleMulDiv=false --relaxedPcCalculation=true --prediction=none --outputFile VexRiscv_LinuxNoDspFmax"
